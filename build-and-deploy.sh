#!/bin/bash

# ================================================
# æ„å»ºå‰ç«¯å¹¶éƒ¨ç½²åˆ°åç«¯staticç›®å½•
# ================================================

set -e

echo "================================================"
echo "  æ„å»ºå‰ç«¯é¡¹ç›®"
echo "================================================"
echo ""

# æ£€æŸ¥Node.js
if ! command -v node &> /dev/null; then
    echo "âŒ Node.js æœªå®‰è£…"
    exit 1
fi

# å®‰è£…ä¾èµ–
if [ ! -d "node_modules" ]; then
    echo "ğŸ“¦ å®‰è£…å‰ç«¯ä¾èµ–..."
    npm install
fi

# æ„å»ºå‰ç«¯
echo "ğŸ”¨ æ„å»ºå‰ç«¯é¡¹ç›®..."
npm run build

# åˆ›å»ºåç«¯staticç›®å½•
echo "ğŸ“ å‡†å¤‡éƒ¨ç½²ç›®å½•..."
rm -rf backend/static
mkdir -p backend/static

# å¤åˆ¶æ„å»ºäº§ç‰©
echo "ğŸ“‹ å¤åˆ¶æ„å»ºäº§ç‰©åˆ°åç«¯..."
cp -r dist/* backend/static/

echo ""
echo "================================================"
echo "  âœ… æ„å»ºå®Œæˆï¼"
echo "================================================"
echo ""
echo "å‰ç«¯å·²æ„å»ºå¹¶å¤åˆ¶åˆ° backend/static/"
echo "ç°åœ¨å¯ä»¥å¯åŠ¨åç«¯æœåŠ¡ï¼š"
echo "  cd backend"
echo "  uvicorn main:app --host 0.0.0.0 --port 8000"
echo ""
